"use strict";angular.module("app",["ui.router","ngAnimate","ngTouch","ui.bootstrap","app.components.navbar","app.components.books.grid","app.components.fallbackimage","app.components.alerts","app.services.BookService","app.services.CategoryService","app.services.ConfigurationService","app.services.UtilService","app.services.SpinnerService","app.filters.html","app.router"]).constant("_",window._).constant("he",window.he).constant("moment",window.moment).config(["$locationProvider","$qProvider","$httpProvider",function(e,t,r){e.html5Mode(!0),r.interceptors.push("myHttpInterceptor")}]).run(["$rootScope","$http","$httpParamSerializerJQLike","AppConfig","ConfigurationService","$log",function(e,t,r,o,a,n){t.defaults.headers.common["app-key"]=o.api_key,t.defaults.transformRequest.unshift(r),t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8",t.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8",a.getConfig().then(function(e){angular.extend(o,e),n.info("[app.js] Configuration fetched.")}).catch(function(e){n.error("[app.js] error",e)}),e.$on("$stateChangeStart",function(e,t,r,o,a){n.info("[app.js] $stateChangeStart")}),e.$on("$stateChangeSuccess",function(e,t,r,o){n.info("[app.js] $stateChangeSuccess")})}]).factory("myHttpInterceptor",["$q",function(e){return{request:function(e){return e},requestError:function(t){return canRecover(t)?responseOrNewPromise:e.reject(t)},response:function(e){return e},responseError:function(t){return canRecover(t)?responseOrNewPromise:e.reject(t)}}}]);var _alertsDirective=function(e,t){function r(r,o,a){return r.alerts=[],r.closeAlert=function(e){r.alerts.splice(e,1)},r.collection&&r.collection.length?r.collection[0].type&&r.collection[0].message?void(r.alerts=t.concat(r.alerts,r.collection)):void e.error("Alerts shoud have objects with 'type' and 'message' properties"):void r.alerts.push({type:r.type,message:r.message})}return{restrict:"E",scope:{type:"=",message:"=",collection:"="},templateUrl:"partials/directives/alerts",replace:!0,link:r}};angular.module("app.components.alerts",[]).directive("alertContainer",["$log","_",_alertsDirective]);var _gridBook=function(e,t,r){function o(e,o,a){e.rows=t.createRows(e.items),r.mode=a.mode||"complete"}return{restrict:"E",scope:{items:"=",search:"="},templateUrl:function(){return"app-templates/gridbook"},replace:!0,link:o}},_gridBookItem=function(){function e(e,t,r){console.log("GridBook directive")}return{restrict:"E",replace:!0,transclude:!0,scope:{bookid:"@"},templateUrl:function(){return"app-templates/gridbookItem"},link:e}},_gridBookData=function(e,t){function r(t,r,o){t.data.published_date=e(t.data.published_date).format("LL"),t.available=!0,t.data.user&&(t.available=!1)}return{restrict:"E",replace:!0,scope:{data:"="},templateUrl:function(e,r){var o=t.mode||"complete";switch(o){case"title":case"poster":return"app-templates/gridbookPoster";case"complete":return"app-templates/gridbookData";default:return"app-templates/gridbookData"}},link:r}};angular.module("app.components.books.grid",[]).run(["$templateCache",function(e){var t='                <div class="row" ng-repeat="row in rows">                     <div ng-repeat="item in row.items | filter:search as results">                        <grid-book-item bookid="{{ item._id }}">                            <grid-book-data                                data="item"                        </grid-book-item>                    </div>                </div>',r='                <div class="col-md-2 fadeIn animated">                    <div class="thumbnail card-link">                        <a ui-sref="books.detail({ book_id: bookid })">                            <ng-transclude></ng-transclude>                        </a>                    </div>                </div>',o='                <div>                    <img ng-src="{{ data.poster }}" alt="{{ data.name }}" style="width:100%">                    <div class="caption">                        <h5 ng-bind-html="data.name | html"></h5>                        <p>                            <strong>Author:</strong><br />{{ data.author }}<br />                            <strong>Category:</strong><br /><span class="label label-primary">{{ data.category }}</span><br />                            <strong>Date Published:</strong><br />{{ data.published_date }}<br />                            <span ng-if="available"><strong>Status:</strong><br /><span class="label label-success">Available</span></span>                            <span ng-if="!available">                                <strong>Status:</strong><br /><span class="label label-default">No available</span><br>                                <strong>User:</strong><br />{{ data.user }}                            </span>                        </p>                    </div>                </div>',a='                <div>                    <img ng-src="{{ data.poster }}" alt="{{ data.name }}" style="width:100%">                    <div class="caption">                        <h5>{{ data.name }}</h5>                    </div>                </div>';e.put("app-templates/gridbook",t),e.put("app-templates/gridbookItem",r),e.put("app-templates/gridbookData",o),e.put("app-templates/gridbookPoster",a)}]).directive("gridBook",["_","UtilService","$rootScope",_gridBook]).directive("gridBookItem",[_gridBookItem]).directive("gridBookData",["moment","$rootScope",_gridBookData]);var _fallBackImage=function(e){function t(e,t,r){var o=r.fallbackSrc||"https://unsplash.it/g/333/500/?random";t.attr("src",o),t.bind("error",function(){angular.element(this).attr("src",o)})}return{link:t}};angular.module("app.components.fallbackimage",[]).directive("fallbackSrc",["$rootScope",_fallBackImage]);var _navbarDirective=function(e){function t(e,t,r){console.log("Todo Something")}return{restrict:"E",templateUrl:"partials/directives/navbar",replace:!0,link:t}};angular.module("app.components.navbar",[]).directive("navBar",["$rootScope",_navbarDirective]);var _AppConfig=function(){var e={api_key:"48rXl9ZG7dm0EAWez4Ls3LyFYVA0g8a4",api_url:"http://api.demo.aguilarcarlos.com/content",base_url:"http://api.demo.aguilarcarlos.com",paths:{book_and_category:"category/book",book:"books/{book_id}",books_category:"/books/category/{category_id}",books:"books",category:"categories/{category_id}",category_books:"categories/{category_id}/books",categories:"categories"}};return{set:function(t){angular.extend(e,t)},$get:function(){return e}}};angular.module("app").provider("AppConfig",[_AppConfig]);var BookController=function(e,t,r,o,a,n,i,s){function c(t){e.loaded=!t,n[t?"show":"hide"]()}function l(){c(!0),t.getBooks().then(function(t){return c(!1),t.length?void(e.books=t):void(e.empty=!0)}).catch(function(t){e.empty=!0})}function p(r){c(!0),t.deleteBook(r).then(function(e){c(!1),o.go("books.index",{},{reload:!0})}).catch(function(t){e.alerts.push({type:"danger",message:"Something went wrong deleting the user."})})}function u(r){c(!0),t.createBook(r).then(function(t){c(!1),e.alerts.push({type:"success",message:t}),e.book={}}).catch(function(t){c(!1),e.alerts.push({type:"danger",message:t})})}function d(r){c(!0),t.getBook(r).then(function(t){return c(!1),t?(t.published_date=a(t.published_date).format("LL"),t.user=t.user||"Not borrowed",void(e.bookDetails=t)):void(e.empty=!0)}).catch(function(t){e.empty=!0})}function g(){c(!0),i.getCategories().then(function(t){c(!1),e.categories=t}).catch(function(e){console.log(e)})}function m(){switch(r.debug("BookController loaded..."),o.current.name){case"books.index":l();break;case"books.detail":if(o.params.book_id)return void d(o.params.book_id);o.go("books.index");break;case"books.edit":if(o.params.book_id)return void g();break;case"books.create":e.picker={opened:!1},e.dateOptions={formatYear:"yy",maxDate:new Date(2020,5,22),minDate:new Date(820,5,22),startingDay:1},g();break;default:l()}}e.books=[],e.book={},e.categories=[],e.loaded=!1,e.empty=!1,e.alerts=[],e.closeAlert=function(t){e.alerts.splice(t,1)},e.removeBook=function(e){e&&p(e)},e.editBook=function(e){o.go("books.edit",{book_id:e})},e.openDatePicker=function(){e.picker.opened=!0},e.createBook=function(t){console.log("submit",e.book),u(t)},m()};angular.module("app").controller("BookController",["$scope","BookService","$log","$state","moment","SpinnerService","CategoryService","_",BookController]);var CategoryController=function(e,t,r,o,a,n){function i(){n.show(),t.getCategoriesWithBooks().then(function(t){n.hide(),t.length||(e.empty=!1),e.categories=t}).catch(function(e){console.log(e)})}function s(){r.debug("CategoryController loaded..."),i()}e.categories=[],e.empty=!1,e.loading=n.isVisible(),s()};angular.module("app").controller("CategoryController",["$scope","CategoryService","$log","$state","UtilService","SpinnerService",CategoryController]);var homeController=function(e){e.myInterval=5e3,e.noWrapSlides=!1,e.active=0;var t=e.slides=[],r=0;600+t.length+1;e.slides.push({image:"http://lorempixel.com/g/1200/400/city/1",text:"The book demo n1",id:r++},{image:"http://lorempixel.com/g/1200/400/city/2",text:"The book demo n2",id:r++},{image:"http://lorempixel.com/g/1200/400/city/3",text:"The book demo n3",id:r++})};angular.module("app").controller("HomeController",["$scope",homeController]),angular.module("app.filters.html",[]).filter("html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),angular.module("app.router",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",abstract:!0,template:"<div ui-view></div>"}),e.state("home.index",{url:"",templateUrl:"partials/home",controller:"HomeController"}),e.state("categories",{url:"/categories",abstract:!0,template:"<div ui-view></div>"}),e.state("categories.index",{url:"",templateUrl:"partials/categories",controller:"CategoryController"}),e.state("books",{url:"/books",abstract:!0,template:"<div ui-view></div>"}),e.state("books.index",{url:"",templateUrl:"partials/books",controller:"BookController"}),e.state("books.create",{url:"/create",templateUrl:"partials/booksCreate",controller:"BookController"}),e.state("books.detail",{url:"/:book_id",templateUrl:"partials/booksDetail",controller:"BookController"}),e.state("books.edit",{url:"/:book_id/edit",templateUrl:"partials/booksDetailEdit",controller:"BookController"}),t.when("/",["$state",function(e){e.go("home.index")}])}]);var _BookService=function(e,t,r,o,a){function n(r,o){var n=t.defer(),i=a.merge({cache:!0},a.isObject(o)?o:{});r||n.reject("Invalid Id");var s=l.book.replace("{book_id}",r);return e.get(s,i).then(function(e){return e=e.data||{},e.error||!e.data.length?n.reject(e.message):void n.resolve(e.data[0])},function(e){return e.data&&e.data.error?n.reject(error.message):void n.reject(e)}).catch(function(e){n.reject(e)}),n.promise}function i(r){var o=t.defer(),n=a.merge({cache:!0},a.isObject(r)?r:{});return e.get(l.books,n).then(function(e){return e=e.data||{},e.error?o.reject(e.message):void o.resolve(e.data)},function(e){return e.data&&e.data.error?o.reject(error.message):void o.reject(e)}).catch(function(e){o.reject(e)}),o.promise}function s(r,o){var n=t.defer(),i=a.merge({},a.isObject(o)?o:{});return e.post(l.books,r,i).then(function(e){return e=e.data||{},e.error?n.reject(e.data.join(" ")||e.message):void n.resolve(e.message)},function(e){return e.data&&e.data.error?n.reject(e.data.message):void n.reject(e)}).catch(function(e){n.reject(e)}),n.promise}function c(r,o){var n=t.defer(),i=a.merge({cache:!0},a.isObject(o)?o:{});if(!r)return n.reject("Invalid Id");var s=l.book.replace("{book_id}",r);return e.delete(s,i).then(function(e){return e=e.data||{},e.error?n.reject(e.message):void n.resolve(e.message)},function(e){return e.data&&e.data.error?n.reject(error.message):void n.reject(e)}).catch(function(e){n.reject(e)}),n.promise}var l={books:o.ensureUrl([r.api_url,r.paths.books]),book:o.ensureUrl([r.api_url,r.paths.book])};return{getBooks:i,getBook:n,deleteBook:c,createBook:s}};angular.module("app.services.BookService",[]).factory("BookService",["$http","$q","AppConfig","UtilService","_",_BookService]);var _CategoryService=function(e,t,r,o,a){var n={categories:o.ensureUrl([r.api_url,r.paths.categories]),category:o.ensureUrl([r.api_url,r.paths.category]),categoryAndBooks:o.ensureUrl([r.api_url,r.paths.book_and_category])};return{getCategories:function(r){var o=t.defer(),i=a.merge({cache:!0},a.isObject(r)?r:{});return e.get(n.categories,i).then(function(e){return e=e.data||{},e.error?o.reject(e.message):void o.resolve(e.data)},function(e){return e.data&&e.data.error?o.reject(error.message):void o.reject(e)}),o.promise},getCategoriesWithBooks:function(r){var o=t.defer(),i=a.merge({cache:!0},a.isObject(r)?r:{});return e.get(n.categoryAndBooks,i).then(function(e){return e=e.data||{},e.error?o.reject(e.message):void o.resolve(e.data)},function(e){return e.data&&e.data.error?o.reject(error.message):void o.reject(e)}),o.promise}}};angular.module("app.services.CategoryService",[]).factory("CategoryService",["$http","$q","AppConfig","UtilService","_",_CategoryService]);var _ConfigurationService=function(e,t,r,o){return{getConfig:function(){return e.get(o.ensureUrl(r.base_url),{cache:!0}).then(function(e){return e.data.data&&e.data.data.length?e.data.data[0]:e.data},function(e){return e.data})}}};angular.module("app.services.ConfigurationService",[]).factory("ConfigurationService",["$http","$q","AppConfig","UtilService",_ConfigurationService]);var _spinnerContainer=function(e,t,r){function o(e,r,o){t.spin=!1}return{restrict:"E",transclude:!0,templateUrl:function(){return"app-templates/spinner-container"},replace:!0,link:o}},_spinner=function(){return{restrict:"E",replace:!0,templateUrl:function(){return"app-templates/spinner"}}},_SpinnerService=function(e,t,r){return{show:function(){r.debug("Showing spinner"),t.spin=!0},hide:function(){r.debug("Hidding spinner"),t.spin=!1},isVisible:function(){return!!t.spin}}};angular.module("app.services.SpinnerService",[]).run(["$templateCache",function(e){var t='            <div class="spinner-container" ng-if="spin">                <ng-transclude></ng-transclude>            </div>',r='            <div class="spinner">                <div class="double-bounce1"></div>                <div class="double-bounce2"></div>            </div>';e.put("app-templates/spinner-container",t),e.put("app-templates/spinner",r)}]).directive("spinnerContainer",["$log","$rootScope","$timeout",_spinnerContainer]).directive("spinner",[_spinner]).factory("SpinnerService",["_","$rootScope","$log",_SpinnerService]);var _UtilService=function(e,t){function r(e,t){t=!!t,e=e?[].concat(e):[];var r=e.join("/");if(!/^https?\s*:\s*\/\//.test(r)){var o=t?"https://":"http://";r=o+r}return r}function o(e,t){t=t||6;for(var r=_.chunk(e,t),o=r.length,a=[],n=0;n<o;n++)a.push({items:r[n]});return a}return{ensureUrl:r,createRows:o}};angular.module("app.services.UtilService",[]).factory("UtilService",["$http","$q",_UtilService]);