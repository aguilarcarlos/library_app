"use strict";angular.module("app",["ui.router","ngAnimate","ngTouch","ui.bootstrap","app.components.navbar","app.components.books.grid","app.services.BookService","app.services.CategoryService","app.services.ConfigurationService","app.services.UtilService","app.router"]).constant("_",window._).constant("moment",window.moment).config(["$locationProvider",function(e){e.html5Mode(!0)}]).run(["$rootScope","$http","AppConfig","ConfigurationService","$log",function(e,t,o,r,a){t.defaults.headers.common["app-key"]=o.api_key,r.getConfig().then(function(e){angular.extend(o,e),a.info("[app.js] Configuration fetched.")}).catch(function(e){a.error("[app.js] error",e)}),e.$on("$stateChangeStart",function(e,t,o,r,i){a.info("[app.js] $stateChangeStart")}),e.$on("$stateChangeSuccess",function(e,t,o,r){a.info("[app.js] $stateChangeSuccess")})}]);var _gridBook=function(e,t,o){function r(e,r,a){e.rows=t.createRows(e.items),o.mode=a.mode||"complete"}return{restrict:"E",scope:{items:"=",search:"="},templateUrl:function(){return"app-templates/gridbook"},replace:!0,link:r}},_gridBookItem=function(){function e(e,t,o){console.log("GridBook directive")}return{restrict:"E",replace:!0,transclude:!0,scope:{bookid:"@"},templateUrl:function(){return"app-templates/gridbookItem"},link:e}},_gridBookData=function(e,t){function o(t,o,r){t.data.published_date=e(t.data.published_date).format("LL"),t.available=!0,t.data.user&&(t.available=!1)}return{restrict:"E",replace:!0,scope:{data:"="},templateUrl:function(e,o){var r=t.mode||"complete";switch(r){case"title":case"poster":return"app-templates/gridbookPoster";case"complete":return"app-templates/gridbookData";default:return"app-templates/gridbookData"}},link:o}};angular.module("app.components.books.grid",[]).run(["$templateCache",function(e){var t='                <div class="row" ng-repeat="row in rows">                     <div ng-repeat="item in row.items | filter:search as results">                        <grid-book-item bookid="{{ item._id }}">                            <grid-book-data                                data="item"                        </grid-book-item>                    </div>                </div>',o='                <div class="col-md-2 fadeIn animated">                    <div class="thumbnail card-link">                        <a ui-sref="books.detail({ book_id: bookid })">                            <ng-transclude></ng-transclude>                        </a>                    </div>                </div>',r='                <div>                    <img ng-src="{{ data.poster }}" alt="{{ data.name }}" style="width:100%">                    <div class="caption">                        <h5>{{ data.name }}</h5>                        <p>                            <strong>Author:</strong><br />{{ data.author }}<br />                            <strong>Category:</strong><br /><span class="label label-primary">{{ data.category_id }}</span><br />                            <strong>Date Published:</strong><br />{{ data.published_date }}<br />                            <span ng-if="available"><strong>Status:</strong><br /><span class="label label-success">Available</span></span>                            <span ng-if="!available">                                <strong>Status:</strong><br /><span class="label label-default">No available</span><br>                                <strong>User:</strong><br />{{ data.user }}                            </span>                        </p>                    </div>                </div>',a='                <div>                    <img ng-src="{{ data.poster }}" alt="{{ data.name }}" style="width:100%">                    <div class="caption">                        <h5>{{ data.name }}</h5>                    </div>                </div>';e.put("app-templates/gridbook",t),e.put("app-templates/gridbookItem",o),e.put("app-templates/gridbookData",r),e.put("app-templates/gridbookPoster",a)}]).directive("gridBook",["_","UtilService","$rootScope",_gridBook]).directive("gridBookItem",[_gridBookItem]).directive("gridBookData",["moment","$rootScope",_gridBookData]);var _nabvarDirective=function(e){function t(e,t,o){console.log("Todo Something")}return{restrict:"E",templateUrl:"partials/directives/navbar",replace:!0,link:t}};angular.module("app.components.navbar",[]).directive("navBar",["$rootScope",_nabvarDirective]);var _AppConfig=function(){var e={api_key:"48rXl9ZG7dm0EAWez4Ls3LyFYVA0g8a4",api_url:"http://api.demo.aguilarcarlos.com/content",base_url:"http://api.demo.aguilarcarlos.com",paths:{book_and_category:"category/book",book:"books/{book_id}",books_category:"/books/category/{category_id}",books:"books",category:"categories/{category_id}",category_books:"categories/{category_id}/books",categories:"categories"}};return{set:function(t){angular.extend(e,t)},$get:function(){return e}}};angular.module("app").provider("AppConfig",[_AppConfig]);var BookController=function(e,t,o,r,a){function i(){t.getBooks().then(function(t){return e.loaded=!0,t.length?void(e.books=t):void(e.empty=!0)}).catch(function(t){e.empty=!0})}function n(o){t.getBook(o).then(function(t){return e.loaded=!0,t?(t.published_date=a(t.published_date).format("LL"),t.user=t.user||"Not borrowed",void(e.bookDetails=t)):void(e.empty=!0)}).catch(function(t){e.empty=!0})}function s(){return o.debug("BookController loaded..."),r.params.book_id?void n(r.params.book_id):void i()}e.books=[],e.loaded=!1,e.empty=!1,s()};angular.module("app").controller("BookController",["$scope","BookService","$log","$state","moment",BookController]);var CategoryController=function(e,t,o,r,a){function i(){t.getCategoriesWithBooks().then(function(t){e.loaded=!0,t.length||(e.empty=!1),e.categories=t}).catch(function(e){console.log(e)})}function n(){o.debug("CategoryController loaded..."),i()}e.categories=[],e.loaded=!1,e.empty=!1,n()};angular.module("app").controller("CategoryController",["$scope","CategoryService","$log","$state","UtilService",CategoryController]);var homeController=function(e,t){e.myInterval=5e3,e.noWrapSlides=!1,e.active=0;var o=e.slides=[],r=0;600+o.length+1;e.slides.push({image:"http://lorempixel.com/g/1200/400/city/1",text:"The book demo n1",id:r++},{image:"http://lorempixel.com/g/1200/400/city/2",text:"The book demo n2",id:r++},{image:"http://lorempixel.com/g/1200/400/city/3",text:"The book demo n3",id:r++})};angular.module("app").controller("HomeController",["$scope","BookService",homeController]),angular.module("app.router",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",abstract:!0,template:"<div ui-view></div>"}),e.state("home.index",{url:"",templateUrl:"partials/home",controller:"HomeController"}),e.state("categories",{url:"/categories",abstract:!0,template:"<div ui-view></div>"}),e.state("categories.index",{url:"",templateUrl:"partials/categories",controller:"CategoryController"}),e.state("books",{url:"/books",abstract:!0,template:"<div ui-view></div>"}),e.state("books.index",{url:"",templateUrl:"partials/books",controller:"BookController"}),e.state("books.detail",{url:"/:book_id",templateUrl:"partials/booksDetail",controller:"BookController"}),t.when("/",["$state",function(e){e.go("home.index")}])}]);var _BookService=function(e,t,o,r,a){var i={books:r.ensureUrl([o.api_url,o.paths.books]),book:r.ensureUrl([o.api_url,o.paths.book])};return{getBooks:function(o){var r=t.defer(),n=a.merge({cache:!0},a.isObject(o)?o:{});return e.get(i.books,n).then(function(e){return e=e.data||{},e.error?r.reject(e.message):void r.resolve(e.data)},function(e){return e.data&&e.data.error?r.reject(error.message):void r.reject(e)}),r.promise},getBook:function(o,r){var n=t.defer(),s=a.merge({cache:!0},a.isObject(r)?r:{});o||n.reject("Invalid Id");var c=i.book.replace("{book_id}",o);return e.get(c,s).then(function(e){return e=e.data||{},e.error||!e.data.length?n.reject(e.message):void n.resolve(e.data[0])},function(e){return e.data&&e.data.error?n.reject(error.message):void n.reject(e)}),n.promise},getBooksByCategory:function(e,t){}}};angular.module("app.services.BookService",[]).factory("BookService",["$http","$q","AppConfig","UtilService","_",_BookService]);var _CategoryService=function(e,t,o,r,a){var i={categories:r.ensureUrl([o.api_url,o.paths.categories]),category:r.ensureUrl([o.api_url,o.paths.category]),categoryAndBooks:r.ensureUrl([o.api_url,o.paths.book_and_category])};return{getCategories:function(o){var r=t.defer(),n=a.merge({cache:!0},a.isObject(o)?o:{});return e.get(i.categories,n).then(function(e){return e=e.data||{},e.error?r.reject(e.message):void r.resolve(e.data)},function(e){return e.data&&e.data.error?r.reject(error.message):void r.reject(e)}),r.promise},getCategoriesWithBooks:function(o){var r=t.defer(),n=a.merge({cache:!0},a.isObject(o)?o:{});return e.get(i.categoryAndBooks,n).then(function(e){return e=e.data||{},e.error?r.reject(e.message):void r.resolve(e.data)},function(e){return e.data&&e.data.error?r.reject(error.message):void r.reject(e)}),r.promise}}};angular.module("app.services.CategoryService",[]).factory("CategoryService",["$http","$q","AppConfig","UtilService","_",_CategoryService]);var _ConfigurationService=function(e,t,o,r){return{getConfig:function(){return e.get(r.ensureUrl(o.base_url),{cache:!0}).then(function(e){return e.data.data&&e.data.data.length?e.data.data[0]:e.data},function(e){return e.data})}}};angular.module("app.services.ConfigurationService",[]).factory("ConfigurationService",["$http","$q","AppConfig","UtilService",_ConfigurationService]);var _UtilService=function(e,t){function o(e,t){t=!!t,e=e?[].concat(e):[];var o=e.join("/");if(!/^https?\s*:\s*\/\//.test(o)){var r=t?"https://":"http://";o=r+o}return o}function r(e,t){t=t||6;for(var o=_.chunk(e,t),r=o.length,a=[],i=0;i<r;i++)a.push({items:o[i]});return a}return{ensureUrl:o,createRows:r}};angular.module("app.services.UtilService",[]).factory("UtilService",["$http","$q",_UtilService]);